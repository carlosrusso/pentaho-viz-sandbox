<!doctype html>
<html>
<head>
  <style>
    #viz_div {
      border: solid 1px #005da6;
      width: 400px;
      height: 200px;
    }
  </style>

  <!-- load requirejs -->
  <script type="text/javascript" src="node_modules/requirejs/require.js"></script>

  <!-- load the VizAPI dev bootstrap helper -->
  <script type="text/javascript" src="node_modules/@nantunes/viz-api/dev-bootstrap.js"></script>

  <!-- configure AMD for the sample visualization -->
  <script>
    require.config({
      packages: [
        {
          "name": "pentaho/visual/samples/bar",
          "main": "model",
          "location": "."
        }
      ],
      paths: {
        "d3": "./node_modules/d3/build/d3"
      }
    });
  </script>

  <script>
    require([
      "pentaho/type/Context",
      "pentaho/data/Table",
      "pentaho/visual/base/view",
      "pentaho/visual/samples/bar"
    ], function(Context, Table, baseViewFactory, barModelFactory) {

      // Setup up a VizAPI context
      var context = new Context({application: "viz-api-sandbox"});

      // Prepare some test data
      var dataTable = new Table({
        model: [
          {name: "productFamily", type: "string", label: "Product Family"},
          {name: "sales",         type: "number", label: "Sales"}
        ],
        rows: [
          {c: [{v: "plains", f: "Plains"}, 123]},
          {c: [{v: "cars",   f: "Cars"  }, 456]}
        ]
      });

      // Create the visualization model.
      var BarModel = context.get(barModelFactory);
      var model = new BarModel({
        "data": dataTable,
        "category": {attributes: ["productFamily"]},
        "measure":  {attributes: ["sales"]},
        "operation": "avg"
      });

      // Mark the container with the model's CSS classes, for styling purposes.
      var domContainer = document.getElementById("viz_div");
      domContainer.className = model.type.inheritedStyleClasses.join(" ");

      // Create the visualization view.
      var BaseView = context.get(baseViewFactory);
      BaseView.createAsync({
        domContainer: domContainer,
        width: 400,
        height: 200,
        model: model
      }).then(function(view) {
        // Render the visualization
        view.update();
      });
    });
  </script>
</head>

<body>
  <!-- div that will contain the visualization -->
  <div id="viz_div"></div>
</body>
</html>
